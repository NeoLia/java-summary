[TOC]

# 1. 简介

MQ——Message Queue（消息队列），一种先进先出的数据结构，现在常用于微服务架构中，优化微服务之间的调用。

# 2. 常用场景

## 2.1. 应用解耦

如果微服务A需要调用微服务B，那么将对微服务B的调用放在MQ中，如果微服务B出现故障，那么等到故障修复后，微服务B可以从MQ中获取等待被处理的调用。这样做能够让用户感觉不到故障，只是有一些延迟。

如果不用MQ，当微服务A耦合调用微服务B时，如果微服务B出现故障，微服务A就会出现处理异常。

## 2.2. 流量削峰

当在某一个时间段里接收到的请求数量超过微服务A能够处理的最大请求数量时，使用MQ能够将暂时处理不了的请求放到MQ里面，等到微服务A能够处理新请求时，再把请求从MQ中拿出来。这样做能够用一定的延迟来处理大量的请求。

如果不用MQ，那么超过限制数量的请求全都会请求失败。

## 2.3. 消息分发

当微服务A产生了一类数据D1，而微服务B、微服务C都对D1感兴趣时，可以创建一个专门存放D1类型数据的MQ，微服务A每次产生D1类型的数据时，都放入MQ中，微服务B、微服务C只需要监听MQ即可。后续有更多微服务对D1类型数据感兴趣时，都只需要监听MQ就行了。

如果不用MQ，那么每当有一个微服务对D1类型数据感兴趣时，都要修改微服务A的代码，调用其他微服务。

## 2.4. 异步消息

如果微服务A需要调用微服务B而微服务B的处理时间较长，那么微服务A就要**异步调用**微服务B，微服务B处理完成后发送消息到MQ中，MQ再将消息转发给微服务A。

如果不用MQ，当微服务A**同步调用**微服务B时，需要每隔一段时间询问一次微服务B处理结果；当微服务A**异步调用**微服务B时，微服务A需要提供callback方法给微服务B，当微服务B处理完成后调用callback方法。





